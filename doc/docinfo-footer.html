<style>
    .copy-link {
      margin-left: .5rem;
      cursor: pointer;
      border: none;
      background: none;
      font: inherit;
    }
    .copy-link[aria-live] { position: relative; }
    .copy-link::after {
      content: attr(data-toast);
      position: absolute;
      top: -1.75rem;
      left: 50%;
      transform: translateX(-50%);
      padding: .15rem .4rem;
      border-radius: .25rem;
      font-size: .75rem;
      background: #333;
      color: #fff;
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease;
    }
    .copy-link.show::after { opacity: 1; }
    </style>
    
    <script>
    (function () {
      function buildPermalink(id) {
        var {origin, pathname, search} = window.location;
        return origin + pathname + search + '#' + id;
      }
      function addCopyButtons() {
        var headings = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
        headings.forEach(function(h) {
          if (h.querySelector('.copy-link')) return; // avoid duplicates
          var btn = document.createElement('button');
          btn.className = 'copy-link';
          btn.type = 'button';
          btn.title = 'Copy link to this section';
          btn.setAttribute('aria-label', 'Copy link to this section');
          btn.setAttribute('data-toast', 'Copied!');
          // simple link icon (SVG). Replace with your own / Font Awesome if you prefer.
          btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true"><path d="M3.9 12a5 5 0 0 1 5-5h3v2h-3a3 3 0 0 0 0 6h3v2h-3a5 5 0 0 1-5-5zm6.2 1h3.9a3 3 0 0 0 0-6h-3.9V5h3.9a5 5 0 0 1 0 10h-3.9v-2z"/></svg>';
    
          btn.addEventListener('click', function () {
            var url = buildPermalink(h.id);
            if (navigator.clipboard && navigator.clipboard.writeText) {
              navigator.clipboard.writeText(url).then(function () {
                btn.classList.add('show');
                setTimeout(function(){ btn.classList.remove('show'); }, 900);
              }).catch(function () {
                fallback(url);
              });
            } else {
              fallback(url);
            }
            function fallback(text) {
              var ta = document.createElement('textarea');
              ta.value = text;
              ta.style.position = 'fixed'; ta.style.left = '-9999px';
              document.body.appendChild(ta);
              ta.select();
              try { document.execCommand('copy'); } catch (e) {}
              document.body.removeChild(ta);
              btn.classList.add('show');
              setTimeout(function(){ btn.classList.remove('show'); }, 900);
            }
          });
    
          // place after the anchor (if any) so both appear
          h.appendChild(btn);
        });
      }
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', addCopyButtons);
      } else {
        addCopyButtons();
      }
    })();
    </script>