<style>
  /* Heading copy-link button */
  h1[id], h2[id], h3[id], h4[id], h5[id], h6[id] { position: relative; }
  .copy-link {
    position: absolute;
    left: -1.6em;              /* sit in the left margin without shifting text */
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    border: none;
    background: none;
    font: inherit;
    font-size: 1.1em;          /* slightly larger */
    opacity: 0;                /* hidden by default */
    pointer-events: auto;
    transition: opacity .15s ease;
    margin: 0;                 /* no layout shift */
    padding: .15rem;
    z-index: 1;
  }
  .copy-link svg { width: 20px; height: 20px; }
  /* Show the icon when hovering the heading or the icon itself, or when the button is focused for keyboard users */
  h1[id]:hover .copy-link,
  h2[id]:hover .copy-link,
  h3[id]:hover .copy-link,
  h4[id]:hover .copy-link,
  h5[id]:hover .copy-link,
  h6[id]:hover .copy-link,
  .copy-link:hover,
  .copy-link:focus,
  .copy-link:focus-visible {
    opacity: 1;
    pointer-events: auto;
  }

  .copy-link[aria-live] { position: relative; }
  .copy-link::after {
    content: attr(data-toast);
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);
    padding: .15rem .4rem;
    border-radius: .25rem;
    font-size: .75rem;
    background: #333;
    color: #fff;
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease;
    white-space: nowrap;
  }
  .copy-link.show::after { opacity: 1; }

  /* Code block copy button */
  .copy-code {
    position: absolute;
    left: -1.6em;              /* sit in the left margin */
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    border: none;
    background: none;
    padding: .3rem;
    border-radius: .25rem;
    opacity: 0;
    pointer-events: auto;
    transition: opacity .15s ease;
    z-index: 2;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }
  .copy-code svg { width: 16px; height: 16px; }
  .listingblock:hover .copy-code,
  .listingblock:focus-within .copy-code,
  .listingblock:hover::before,
  .listingblock:hover::after,
  .copy-code:focus,
  .copy-code:focus-visible,
  .copy-code:hover {
    opacity: 1;
    pointer-events: auto;
  }
  .copy-code[aria-live] { position: relative; }
  .copy-code::after {
    content: attr(data-toast);
    position: absolute;
    bottom: 120%;
    left: 50%;
    transform: translateX(-50%);
    font-size: .75rem;
    padding: .1rem .3rem;
    border-radius: .25rem;
    background: #333;
    color: #fff;
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease;
    white-space: nowrap;
    writing-mode: horizontal-tb !important; /* ensure not vertical */
  }
  .copy-code.show::after { opacity: 1; }

  /* Ensure the button positions inside code blocks */
  .listingblock { position: relative; }

  /* Hover buffer on the left margin so the icon stays visible when approaching it */
  .listingblock::before {
    content: "";
    position: absolute;
    left: -2.2em;   /* slightly wider than icon offset */
    top: 0;
    bottom: 0;
    width: 2.2em;
  }

  /* Move code block language label to bottom-right */
  .listingblock pre.highlight {
    position: relative;
    padding-bottom: 0; /* space for label */
  }
  .listingblock code[data-lang] {
    position: relative;
    display: block;
  }
  .listingblock code[data-lang]::before {
    top: -1.2em;
    left: 0;
    margin: 0;
    padding: 0;
    writing-mode: horizontal-tb; /* force horizontal label */
    transform: none !important;  /* cancel any theme rotation */
    display: inline-block;
    line-height: 1;
    white-space: nowrap;
    opacity: 0;
    transition: opacity .15s ease;
  }
  /* Force horizontal language label across common themes/selectors */
  .listingblock pre[data-lang]::before,
  .listingblock pre::before,
  .listingblock .hljs::before,
  .listingblock code[class^="language-"]::before,
  .listingblock pre[class^="language-"]::before {
    writing-mode: horizontal-tb !important;
    transform: none !important;
    display: inline-block !important;
    line-height: 1 !important;
    white-space: nowrap !important;
    top: -1.2em !important;
    left: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    right: auto !important;
    position: absolute !important;
    opacity: 0 !important;
    transition: opacity .15s ease !important;
  }
  .listingblock:hover code[data-lang]::before,
  .listingblock:hover pre[data-lang]::before,
  .listingblock:hover pre::before,
  .listingblock:hover .hljs::before,
  .listingblock:hover code[class^="language-"]::before,
  .listingblock:hover pre[class^="language-"]::before {
    opacity: 1 !important;
  }
</style>

<script>
(function () {
  function buildPermalink(id) {
    var loc = window.location;
    return loc.origin + loc.pathname + loc.search + '#' + id;
  }

  function addHeadingCopy() {
    var headings = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
    headings.forEach(function(h) {
      if (h.querySelector('.copy-link')) return; // avoid duplicates
      var btn = document.createElement('button');
      btn.className = 'copy-link';
      btn.type = 'button';
      btn.title = 'Copy link to this section';
      btn.setAttribute('aria-label', 'Copy link to this section');
      btn.setAttribute('data-toast', 'Copied!');
      btn.innerHTML = '<span aria-hidden="true">ðŸ”–</span>';
      btn.addEventListener('click', function () {
        var url = buildPermalink(h.id);
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(url).then(showToast).catch(function () { fallback(url); });
        } else {
          fallback(url);
        }
        function fallback(text) {
          var ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed'; ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); } catch (e) {}
          document.body.removeChild(ta);
          showToast();
        }
        function showToast(){ btn.classList.add('show'); setTimeout(function(){ btn.classList.remove('show'); }, 900); }
      });
      // place after the anchor (if any) so both appear
      h.appendChild(btn);
    });
  }

  function addCodeCopy() {
    document.querySelectorAll('.listingblock pre').forEach(function(pre) {
      var wrapper = pre.closest('.listingblock');
      if (!wrapper || wrapper.querySelector('.copy-code')) return; // avoid duplicates
      var btn = document.createElement('button');
      btn.className = 'copy-code';
      btn.type = 'button';
      btn.title = 'Copy code';
      btn.setAttribute('aria-label', 'Copy code block');
      btn.setAttribute('data-toast', 'Copied!');
      btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
      btn.addEventListener('click', function () {
        var codeEl = pre.querySelector('code');
        var raw = codeEl ? codeEl.textContent : (pre.textContent || pre.innerText);
        // Normalize to a single line: remove newlines and collapse excess whitespace
        var code = raw
          .replace(/\r\n/g, '\n')   // unify line endings
          .replace(/\u00A0/g, ' ')    // nbsp to normal space
          .replace(/[ \t]+\n/g, '\n') // trim end-of-line spaces
          .replace(/\n+/g, ' ')       // join lines with a single space
          .replace(/[ \t]{2,}/g, ' ') // collapse multiple spaces
          .trim();
        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard.writeText(code).then(showToast).catch(function () { fallback(code); });
        } else {
          fallback(code);
        }
        function fallback(text) {
          var ta = document.createElement('textarea');
          ta.value = text;
          ta.style.position = 'fixed'; ta.style.left = '-9999px';
          document.body.appendChild(ta);
          ta.select();
          try { document.execCommand('copy'); } catch (e) {}
          document.body.removeChild(ta);
          showToast();
        }
        function showToast(){ btn.classList.add('show'); setTimeout(function(){ btn.classList.remove('show'); }, 900); }
      });
      wrapper.appendChild(btn);
    });
  }

  function init(){
    addHeadingCopy();
    addCodeCopy();
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>